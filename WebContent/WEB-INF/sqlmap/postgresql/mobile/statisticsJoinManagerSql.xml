<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.msp.admin.mobile.statistics.mapper.StatisticsJoinDao">

    <resultMap type="kr.msp.admin.mobile.statistics.dto.SvcCodeDto" id="SvcCodeDto">
		<result property="SVC_ID"				column = "SVC_ID" 			/>
		<result property="SVC_NM"				column = "SVC_NM" 			/>
	</resultMap>
	
    <!-- Begin of paging process part -->
    <sql id="head">
        SELECT viewC.*
        FROM (
            SELECT
                (ROW_NUMBER() OVER()) AS "RNUM"
                ,COUNT(*) OVER() AS "TOT_CNT"
                ,viewB.*
            FROM (SELECT viewA.* FROM (
    </sql>

    <sql id="bottom">
        ) AS viewA
        ) AS viewB
        ) AS viewC
        WHERE "RNUM" BETWEEN (CAST(#{PAGE_NUM} AS INTEGER) -1) * CAST(#{PAGE_SIZE} AS INTEGER) + 1 AND CAST(#{PAGE_NUM} AS INTEGER) * CAST(#{PAGE_SIZE} AS INTEGER)
    </sql>
    <!-- End of paging process part -->
	
	
	<!--Select mobile Service Code-->
	<select id="selectSvcCode" parameterType="java.util.HashMap" resultType="java.util.HashMap">
      	SELECT S1."SVC_ID", S1."SVC_NM", S1."APP_ID"
	    FROM "TB_SVC" AS S1 ,"TB_SVC_AUTH" AS S2,"TB_MOB_SVC" AS S3, "TB_SYS_USER_AUTH_GRP" AS S4
	    WHERE S1."SVC_ID" = S2."SVC_ID"
		AND S1."SVC_ID" = S3."SVC_ID"
		AND COALESCE(S3."USE_YN" ,'N') = 'Y'
		AND S2."AUTH_GRP_ID"=S4."AUTH_GRP_ID"
		AND "USER_ID"= #{S_ID_USER}
	</select>

    <!-- Select List Of DownloadStatistics -->
    <select id="selectSvcId"  resultMap="SvcCodeDto">
			SELECT  A."SVC_ID", A."SVC_NM"
			FROM    "TB_SVC" AS A
			            INNER JOIN "TB_STO_SVC" AS B
			                ON A."SVC_ID" = B."SVC_ID"
			WHERE B."USE_YN" = 'Y'
			ORDER BY "SVC_NM"
			
    </select>
    <!-- Period Statistics per Time  -->
    <select id="selectPeriodTimeStatistics"  parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT TO_CHAR(T1."REG_DTTM",'hh24') AS "DT", COUNT(*) AS "CNT"
        FROM "TB_MOB_EVENT_LOG" AS T1
        WHERE T1."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT},'YYYY.MM.DD hh24:mi:ss')
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND T1."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        GROUP BY TO_CHAR(T1."REG_DTTM",'hh24')
        ORDER BY TO_CHAR(T1."REG_DTTM",'hh24') ASC
    </select>

    <!-- Period Statistics per Day  -->
    <select id="selectPeriodDayStatistics"  parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT TO_CHAR(T1."REG_DTTM",'YYYYMMDD') AS "DT", COUNT(*) AS "CNT"
        FROM "TB_MOB_EVENT_LOG" AS T1
        WHERE T1."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT},'YYYY.MM.DD hh24:mi:ss')
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND T1."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        GROUP BY TO_CHAR(T1."REG_DTTM",'YYYYMMDD')
        ORDER BY TO_CHAR(T1."REG_DTTM",'YYYYMMDD') ASC
    </select>

    <!-- Period Statistics per Week  -->
    <select id="selectPeriodWeekStatistics"  parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT TO_CHAR("T1"."REG_DTTM",'d') AS "DT", COUNT(*) AS "CNT"
        FROM "TB_MOB_EVENT_LOG" AS "T1"
        WHERE "T1"."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT},'YYYY.MM.DD hh24:mi:ss')
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND "T1"."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        GROUP BY TO_CHAR("T1"."REG_DTTM",'d')
        ORDER BY TO_CHAR("T1"."REG_DTTM",'d') ASC
    </select>

    <!-- OS Statistics  -->
    <select id="selectPerioOSStatistics"  parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT "OS_NM", COUNT(*) AS "CNT"
        FROM "TB_MOB_EVENT_LOG" AS "T1"
        WHERE "T1"."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT},'YYYY.MM.DD hh24:mi:ss')
        AND "OS_NM" IS NOT NULL
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND "T1"."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        GROUP BY "OS_NM"
        ORDER BY "CNT" desc
    </select>

    <!-- Select User Statistics -->
    <select id="selectUserStatistics" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        <include refid="head"/><!-- include head of paging query-->
        SELECT
        "USER_NM","USER_ID",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '0' DAY , 'MMDD') THEN 1 ELSE 0 END) "D1",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '1' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D2",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '2' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D3",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '3' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D4",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '4' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D5",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '5' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D6",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '6' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D7",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '7' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D8",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '8' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D9",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '9' DAY ,  'MMDD') THEN 1 ELSE 0 END) "D10",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '10' DAY , 'MMDD') THEN 1 ELSE 0 END) "D11",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '11' DAY , 'MMDD') THEN 1 ELSE 0 END) "D12",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '12' DAY , 'MMDD') THEN 1 ELSE 0 END) "D13",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '13' DAY , 'MMDD') THEN 1 ELSE 0 END) "D14",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '14' DAY , 'MMDD') THEN 1 ELSE 0 END) "D15",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '15' DAY , 'MMDD') THEN 1 ELSE 0 END) "D16",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '16' DAY , 'MMDD') THEN 1 ELSE 0 END) "D17",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '17' DAY , 'MMDD') THEN 1 ELSE 0 END) "D18",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '18' DAY , 'MMDD') THEN 1 ELSE 0 END) "D19",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '19' DAY , 'MMDD') THEN 1 ELSE 0 END) "D20",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '20' DAY , 'MMDD') THEN 1 ELSE 0 END) "D21",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '21' DAY , 'MMDD') THEN 1 ELSE 0 END) "D22",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '22' DAY , 'MMDD') THEN 1 ELSE 0 END) "D23",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '23' DAY , 'MMDD') THEN 1 ELSE 0 END) "D24",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '24' DAY , 'MMDD') THEN 1 ELSE 0 END) "D25",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '25' DAY , 'MMDD') THEN 1 ELSE 0 END) "D26",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '26' DAY , 'MMDD') THEN 1 ELSE 0 END) "D27",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '27' DAY , 'MMDD') THEN 1 ELSE 0 END) "D28",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '28' DAY , 'MMDD') THEN 1 ELSE 0 END) "D29",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '29' DAY , 'MMDD') THEN 1 ELSE 0 END) "D30",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '30' DAY , 'MMDD') THEN 1 ELSE 0 END) "D31"
        FROM "TB_MOB_EVENT_LOG" AS T1
        WHERE T1."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT} || ' 23:59:59', 'YYYY.MM.DD hh24:mi:ss')
        AND T1."USER_NM" IS NOT NULL
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND T1."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        <if test="SearchWord !=null and SearchWord !=''">
			<if test="SearchKey ==  'USER_ID'"  >
					AND T1."USER_ID" LIKE '%' || #{SearchWord} || '%'
			</if>
				<if test="SearchKey ==  'USER_NM'"  >
						AND T1."USER_NM" LIKE '%' || #{SearchWord} || '%'
				</if>
			<if test="SearchKey ==  'COMP_CD'"  >
					AND T1."COMP_CD" LIKE '%' || #{SearchWord} || '%'
			</if>
        	</if>
        GROUP BY "USER_NM","USER_ID"
        <include refid="bottom"/><!-- include tail of paging query-->
    </select>

    <!-- Select User Statistics Chart-->
    <select id="selectUserStatisticChart" parameterType="java.util.HashMap" resultType="java.util.HashMap">

        SELECT
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '0' DAY, 'MMDD') THEN 1 ELSE 0 END) "D1",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '1' DAY, 'MMDD') THEN 1 ELSE 0 END) "D2",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '2' DAY, 'MMDD') THEN 1 ELSE 0 END) "D3",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '3' DAY, 'MMDD') THEN 1 ELSE 0 END) "D4",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '4' DAY, 'MMDD') THEN 1 ELSE 0 END) "D5",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '5' DAY, 'MMDD') THEN 1 ELSE 0 END) "D6",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '6' DAY, 'MMDD') THEN 1 ELSE 0 END) "D7",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '7' DAY, 'MMDD') THEN 1 ELSE 0 END) "D8",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '8' DAY, 'MMDD') THEN 1 ELSE 0 END) "D9",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '9' DAY, 'MMDD') THEN 1 ELSE 0 END) "D10",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '10' DAY, 'MMDD') THEN 1 ELSE 0 END) "D11",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '11' DAY, 'MMDD') THEN 1 ELSE 0 END) "D12",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '12' DAY, 'MMDD') THEN 1 ELSE 0 END) "D13",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '13' DAY, 'MMDD') THEN 1 ELSE 0 END) "D14",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '14' DAY, 'MMDD') THEN 1 ELSE 0 END) "D15",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '15' DAY, 'MMDD') THEN 1 ELSE 0 END) "D16",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '16' DAY, 'MMDD') THEN 1 ELSE 0 END) "D17",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '17' DAY, 'MMDD') THEN 1 ELSE 0 END) "D18",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '18' DAY, 'MMDD') THEN 1 ELSE 0 END) "D19",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '19' DAY, 'MMDD') THEN 1 ELSE 0 END) "D20",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '20' DAY, 'MMDD') THEN 1 ELSE 0 END) "D21",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '21' DAY, 'MMDD') THEN 1 ELSE 0 END) "D22",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '22' DAY, 'MMDD') THEN 1 ELSE 0 END) "D23",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '23' DAY, 'MMDD') THEN 1 ELSE 0 END) "D24",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '24' DAY, 'MMDD') THEN 1 ELSE 0 END) "D25",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '25' DAY, 'MMDD') THEN 1 ELSE 0 END) "D26",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '26' DAY, 'MMDD') THEN 1 ELSE 0 END) "D27",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '27' DAY, 'MMDD') THEN 1 ELSE 0 END) "D28",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '28' DAY, 'MMDD') THEN 1 ELSE 0 END) "D29",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '29' DAY, 'MMDD') THEN 1 ELSE 0 END) "D30",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT},'YYYY.MM.DD')+ INTERVAL '30' DAY, 'MMDD') THEN 1 ELSE 0 END) "D31"
        FROM "TB_MOB_EVENT_LOG" AS T1
        WHERE T1."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT} || ' 23:59:59', 'YYYY.MM.DD hh24:mi:ss')
        AND T1."USER_NM" IS NOT NULL
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND T1."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        <if test="SearchWord !=null and SearchWord !=''">
			<if test="SearchKey ==  'USER_ID'"  >
					AND T1."USER_ID" LIKE '%' || #{SearchWord} || '%'
			</if>
				<if test="SearchKey ==  'USER_NM'"  >
                    AND T1."USER_NM" LIKE '%' || #{SearchWord} || '%'
				</if>
			<if test="SearchKey ==  'COMP_CD'"  >
					AND T1."COMP_CD" LIKE '%' || #{SearchWord} || '%'
			</if>
        	</if>
    </select>

    <!-- Select User Excel Statistics -->
    <select id="selectUserStatisticsExcel" parameterType="java.util.HashMap" resultType="java.util.HashMap">

        SELECT
        "USER_NM","USER_ID",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '0' DAY , 'MMDD') THEN 1 ELSE 0 END)"D1",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '1' DAY, 'MMDD') THEN 1 ELSE 0 END) "D2",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '2' DAY, 'MMDD') THEN 1 ELSE 0 END) "D3",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '3' DAY, 'MMDD') THEN 1 ELSE 0 END) "D4",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '4' DAY, 'MMDD') THEN 1 ELSE 0 END) "D5",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '5' DAY, 'MMDD') THEN 1 ELSE 0 END) "D6",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '6' DAY, 'MMDD') THEN 1 ELSE 0 END) "D7",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '7' DAY, 'MMDD') THEN 1 ELSE 0 END) "D8",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '8' DAY, 'MMDD') THEN 1 ELSE 0 END) "D9",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '9' DAY, 'MMDD') THEN 1 ELSE 0 END) "D10",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '10' DAY, 'MMDD') THEN 1 ELSE 0 END) "D11",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '11' DAY, 'MMDD') THEN 1 ELSE 0 END) "D12",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '12' DAY, 'MMDD') THEN 1 ELSE 0 END) "D13",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '13' DAY, 'MMDD') THEN 1 ELSE 0 END) "D14",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '14' DAY, 'MMDD') THEN 1 ELSE 0 END) "D15",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '15' DAY, 'MMDD') THEN 1 ELSE 0 END) "D16",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '16' DAY, 'MMDD') THEN 1 ELSE 0 END) "D17",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '17' DAY, 'MMDD') THEN 1 ELSE 0 END) "D18",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '18' DAY, 'MMDD') THEN 1 ELSE 0 END) "D19",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '19' DAY, 'MMDD') THEN 1 ELSE 0 END) "D20",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '20' DAY, 'MMDD') THEN 1 ELSE 0 END) "D21",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '21' DAY, 'MMDD') THEN 1 ELSE 0 END) "D22",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '22' DAY, 'MMDD') THEN 1 ELSE 0 END) "D23",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '23' DAY, 'MMDD') THEN 1 ELSE 0 END) "D24",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '24' DAY, 'MMDD') THEN 1 ELSE 0 END) "D25",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '25' DAY, 'MMDD') THEN 1 ELSE 0 END) "D26",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '26' DAY, 'MMDD') THEN 1 ELSE 0 END) "D27",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '27' DAY, 'MMDD') THEN 1 ELSE 0 END) "D28",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '28' DAY, 'MMDD') THEN 1 ELSE 0 END) "D29",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '29' DAY, 'MMDD') THEN 1 ELSE 0 END) "D30",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '30' DAY, 'MMDD') THEN 1 ELSE 0 END) "D31"
        FROM "TB_MOB_EVENT_LOG" AS T1
        WHERE T1."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT} || ' 23:59:59', 'YYYY.MM.DD hh24:mi:ss')
        AND T1."USER_NM" IS NOT NULL
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND T1."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        <if test="SearchWord !=null and SearchWord !=''">
			<if test="SearchKey ==  'USER_ID'"  >
					AND T1."USER_ID" LIKE '%' || #{SearchWord} || '%'
			</if>
				<if test="SearchKey ==  'USER_NM'"  >
					AND T1."USER_NM" LIKE '%' || #{SearchWord} || '%'
				</if>
			<if test="SearchKey ==  'COMP_CD'"  >
					AND T1."COMP_CD" LIKE '%' || #{SearchWord} || '%'
			</if>
        	</if>
        GROUP BY "USER_NM","USER_ID"
    </select>
    <!-- Protocol Statistic-->
    <select id="selectProtocolStatistics" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        <include refid="head"/><!-- include head of paging query-->
        SELECT
        T1."COMP_CD",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '0' DAY, 'MMDD') THEN 1 ELSE 0 END) "D1",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '1' DAY, 'MMDD') THEN 1 ELSE 0 END) "D2",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '2' DAY, 'MMDD') THEN 1 ELSE 0 END) "D3",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '3' DAY, 'MMDD') THEN 1 ELSE 0 END) "D4",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '4' DAY, 'MMDD') THEN 1 ELSE 0 END) "D5",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '5' DAY, 'MMDD') THEN 1 ELSE 0 END) "D6",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '6' DAY, 'MMDD') THEN 1 ELSE 0 END) "D7",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '7' DAY, 'MMDD') THEN 1 ELSE 0 END) "D8",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '8' DAY, 'MMDD') THEN 1 ELSE 0 END) "D9",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '9' DAY, 'MMDD') THEN 1 ELSE 0 END) "D10",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '10' DAY, 'MMDD') THEN 1 ELSE 0 END) "D11",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '11' DAY, 'MMDD') THEN 1 ELSE 0 END) "D12",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '12' DAY, 'MMDD') THEN 1 ELSE 0 END) "D13",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '13' DAY, 'MMDD') THEN 1 ELSE 0 END) "D14",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '14' DAY, 'MMDD') THEN 1 ELSE 0 END) "D15",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '15' DAY, 'MMDD') THEN 1 ELSE 0 END) "D16",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '16' DAY, 'MMDD') THEN 1 ELSE 0 END) "D17",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '17' DAY, 'MMDD') THEN 1 ELSE 0 END) "D18",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '18' DAY, 'MMDD') THEN 1 ELSE 0 END) "D19",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '19' DAY, 'MMDD') THEN 1 ELSE 0 END) "D20",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '20' DAY, 'MMDD') THEN 1 ELSE 0 END) "D21",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '21' DAY, 'MMDD') THEN 1 ELSE 0 END) "D22",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '22' DAY, 'MMDD') THEN 1 ELSE 0 END) "D23",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '23' DAY, 'MMDD') THEN 1 ELSE 0 END) "D24",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '24' DAY, 'MMDD') THEN 1 ELSE 0 END) "D25",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '25' DAY, 'MMDD') THEN 1 ELSE 0 END) "D26",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '26' DAY, 'MMDD') THEN 1 ELSE 0 END) "D27",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '27' DAY, 'MMDD') THEN 1 ELSE 0 END) "D28",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '28' DAY, 'MMDD') THEN 1 ELSE 0 END) "D29",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '29' DAY, 'MMDD') THEN 1 ELSE 0 END) "D30",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+30, 'MMDD') THEN 1 ELSE 0 END) D31
        FROM "TB_MOB_EVENT_LOG" AS T1
        WHERE T1."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT} || ' 23:59:59', 'YYYY.MM.DD hh24:mi:ss')
        AND T1."COMP_CD" IS NOT NULL
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND T1."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
       <if test="SearchWord !=null and SearchWord !=''">
			<if test="SearchKey ==  'USER_ID'"  >
					AND T1."USER_ID" LIKE '%' || #{SearchWord} || '%'
			</if>
				<if test="SearchKey ==  'USER_NM'"  >
                    AND T1."USER_NM" LIKE '%' || #{SearchWord} || '%'
				</if>
			<if test="SearchKey ==  'COMP_CD'"  >
					AND T1."COMP_CD" LIKE '%' || #{SearchWord} || '%'
			</if>
        	</if>
        GROUP BY T1."COMP_CD"
        <include refid="bottom"/><!-- include tail of paging query-->
    </select>

    <!-- Protocol Chart Statistic-->
    <select id="selectProtocolStatisticsChart" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '0' DAY, 'MMDD') THEN 1 ELSE 0 END) "D1",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '1' DAY, 'MMDD') THEN 1 ELSE 0 END) "D2",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '2' DAY, 'MMDD') THEN 1 ELSE 0 END) "D3",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '3' DAY, 'MMDD') THEN 1 ELSE 0 END) "D4",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '4' DAY, 'MMDD') THEN 1 ELSE 0 END) "D5",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '5' DAY, 'MMDD') THEN 1 ELSE 0 END) "D6",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '6' DAY, 'MMDD') THEN 1 ELSE 0 END) "D7",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '7' DAY, 'MMDD') THEN 1 ELSE 0 END) "D8",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '8' DAY, 'MMDD') THEN 1 ELSE 0 END) "D9",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '9' DAY, 'MMDD') THEN 1 ELSE 0 END) "D10",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '10' DAY, 'MMDD') THEN 1 ELSE 0 END) "D11",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '11' DAY, 'MMDD') THEN 1 ELSE 0 END) "D12",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '12' DAY, 'MMDD') THEN 1 ELSE 0 END) "D13",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '13' DAY, 'MMDD') THEN 1 ELSE 0 END) "D14",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '14' DAY, 'MMDD') THEN 1 ELSE 0 END) "D15",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '15' DAY, 'MMDD') THEN 1 ELSE 0 END) "D16",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '16' DAY, 'MMDD') THEN 1 ELSE 0 END) "D17",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '17' DAY, 'MMDD') THEN 1 ELSE 0 END) "D18",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '18' DAY, 'MMDD') THEN 1 ELSE 0 END) "D19",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '19' DAY, 'MMDD') THEN 1 ELSE 0 END) "D20",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '20' DAY, 'MMDD') THEN 1 ELSE 0 END) "D21",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '21' DAY, 'MMDD') THEN 1 ELSE 0 END) "D22",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '22' DAY, 'MMDD') THEN 1 ELSE 0 END) "D23",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '23' DAY, 'MMDD') THEN 1 ELSE 0 END) "D24",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '24' DAY, 'MMDD') THEN 1 ELSE 0 END) "D25",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '25' DAY, 'MMDD') THEN 1 ELSE 0 END) "D26",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '26' DAY, 'MMDD') THEN 1 ELSE 0 END) "D27",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '27' DAY, 'MMDD') THEN 1 ELSE 0 END) "D28",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '28' DAY, 'MMDD') THEN 1 ELSE 0 END) "D29",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '29' DAY, 'MMDD') THEN 1 ELSE 0 END) "D30",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '30' DAY, 'MMDD') THEN 1 ELSE 0 END) "D31"
        FROM "TB_MOB_EVENT_LOG" AS T1
        WHERE T1."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT} || ' 23:59:59', 'YYYY.MM.DD hh24:mi:ss')
        AND T1."COMP_CD" IS NOT NULL
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND T1."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        <if test="SearchWord !=null and SearchWord !=''">
			<if test="SearchKey ==  'USER_ID'"  >
					AND T1."USER_ID" LIKE '%' || #{SearchWord} || '%'
			</if>
				<if test="SearchKey ==  'USER_NM'"  >
                    AND T1."USER_NM" LIKE '%' || #{SearchWord} || '%'
				</if>
			<if test="SearchKey ==  'COMP_CD'"  >
					AND T1."COMP_CD" LIKE '%' || #{SearchWord} || '%'
			</if>
        	</if>
    </select>

    <!-- Protocol Excel Statistic-->
    <select id="selectProtocolStatisticsExcel" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
        T1.COMP_CD,
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '0' DAY, 'MMDD') THEN 1 ELSE 0 END) "D1",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '1' DAY, 'MMDD') THEN 1 ELSE 0 END) "D2",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '2' DAY, 'MMDD') THEN 1 ELSE 0 END) "D3",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '3' DAY, 'MMDD') THEN 1 ELSE 0 END) "D4",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '4' DAY, 'MMDD') THEN 1 ELSE 0 END) "D5",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '5' DAY, 'MMDD') THEN 1 ELSE 0 END) "D6",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '6' DAY, 'MMDD') THEN 1 ELSE 0 END) "D7",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '7' DAY, 'MMDD') THEN 1 ELSE 0 END) "D8",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '8' DAY, 'MMDD') THEN 1 ELSE 0 END) "D9",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '9' DAY, 'MMDD') THEN 1 ELSE 0 END) "D10",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '10' DAY, 'MMDD') THEN 1 ELSE 0 END) "D11",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '11' DAY, 'MMDD') THEN 1 ELSE 0 END) "D12",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '12' DAY, 'MMDD') THEN 1 ELSE 0 END) "D13",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '13' DAY, 'MMDD') THEN 1 ELSE 0 END) "D14",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '14' DAY, 'MMDD') THEN 1 ELSE 0 END) "D15",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '15' DAY, 'MMDD') THEN 1 ELSE 0 END) "D16",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '16' DAY, 'MMDD') THEN 1 ELSE 0 END) "D17",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '17' DAY, 'MMDD') THEN 1 ELSE 0 END) "D18",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '18' DAY, 'MMDD') THEN 1 ELSE 0 END) "D19",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '19' DAY, 'MMDD') THEN 1 ELSE 0 END) "D20",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '20' DAY, 'MMDD') THEN 1 ELSE 0 END) "D21",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '21' DAY, 'MMDD') THEN 1 ELSE 0 END) "D22",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '22' DAY, 'MMDD') THEN 1 ELSE 0 END) "D23",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '23' DAY, 'MMDD') THEN 1 ELSE 0 END) "D24",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '24' DAY, 'MMDD') THEN 1 ELSE 0 END) "D25",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '25' DAY, 'MMDD') THEN 1 ELSE 0 END) "D26",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '26' DAY, 'MMDD') THEN 1 ELSE 0 END) "D27",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '27' DAY, 'MMDD') THEN 1 ELSE 0 END) "D28",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '28' DAY, 'MMDD') THEN 1 ELSE 0 END) "D29",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '29' DAY, 'MMDD') THEN 1 ELSE 0 END) "D30",
        SUM(CASE TO_CHAR(T1."REG_DTTM", 'MMDD') WHEN TO_CHAR(TO_DATE(#{START_DT}, 'YYYY.MM.DD')+ INTERVAL '30' DAY, 'MMDD') THEN 1 ELSE 0 END) "D31"
        FROM "TB_MOB_EVENT_LOG" AS T1
        WHERE T1."REG_DTTM" BETWEEN TO_DATE(#{START_DT},'YYYY.MM.DD') AND TO_DATE(#{END_DT} || ' 23:59:59', 'YYYY.MM.DD hh24:mi:ss')
        AND T1."COMP_CD" IS NOT NULL
        <if test="SVC_ID != null and SVC_ID!=''" >
            AND T1."SVC_ID" = CAST(#{SVC_ID} AS BIGINT)
        </if>
        <if test="SearchWord !=null and SearchWord !=''">
			<if test="SearchKey ==  'USER_ID'"  >
					AND T1."USER_ID LIKE" '%' || #{SearchWord} || '%'
			</if>
				<if test="SearchKey ==  'USER_NM'"  >
                    AND T1."USER_NM" LIKE '%' || #{SearchWord} || '%'
				</if>
			<if test="SearchKey ==  'COMP_CD'"  >
					AND T1."COMP_CD" LIKE '%' || #{SearchWord} || '%'
			</if>
        	</if>
        GROUP BY T1."COMP_CD"
    </select>


        
    
</mapper>